<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>

    <meta name="HandheldFriendly" content="true"/>
    <link rel="stylesheet" href="../index.css">

    <title>Метлайн</title>
</head>
<body>
  <style type="text/css">
   #k47dfc{position:relative;width:992px;height:60px;margin:0px auto 17px auto; overflow:hidden;}

#ke0131{position:relative;width:728px;height:100px;margin:37px auto 37px auto; overflow:hidden;}

.k49812{z-index:666;}

.k5f1a7{z-index:766;}

.kd0178{position:absolute;left:0;top:0;width:100%;}



.k80a9d{visibility:hidden; width:100%; padding-top:6.2%; height:1px;}

.kdb63d{visibility:hidden; width:100%; padding-top:14%; height:1px;}



@media (max-width: 992px) {

	#k47dfc{max-width:992px; width:auto; height:auto; overflow:hidden;}

	#ke0131{max-width:728px; width:auto; height:auto; overflow:hidden;}

}
  </style>
  <script type="text/javascript">
   $(document).ready(function() 

    { 

    	setInterval(function() { rotate_banners(8100) }, 8100);



    	  function rotate_banners(interval){

			var id;

			var image_change_speed = 1300;

			var link_and_class_change_speed = 1000; //ссылка меняется только после почти полной смены баннера

			var hnc_class = "k5f1a7";

			var snc_class = "k49812";



			$( '.' + snc_class ).fadeIn( image_change_speed );

			$( '.' + hnc_class ).fadeOut( image_change_speed );



			setTimeout(function() {  

				$( '.' + hnc_class + ' a' ).hide();

				$( '.' + snc_class + ' a' ).show();



				$( '.' + hnc_class ).removeClass( hnc_class ).addClass('banner-tmp');

				$( '.' + snc_class ).addClass( hnc_class );

				$( '.' + snc_class ).removeClass( snc_class );

				$( '.banner-tmp' ).addClass(snc_class).removeClass('banner-tmp');

			}, link_and_class_change_speed);

		}



    }

);
  </script>
  <div id="k47dfc">
   <div class="k80a9d">
   </div>
   <div class="k5f1a7 kd0178" style="display:block;">
    <img alt="" src="http://cdn.23met.ru/b/2019_sktmk_992x60_495.png" style="display:block;left:0;top:0;z-index:1;width:100%;"/>
    <a href="https://sk-tmk.ru/?23met=1.html" rel="nofollow noopener" style="display:block; position:absolute; left:0%;top:0;width:100%;height:60px;" target="_blank">
    </a>
   </div>
   <div class="k49812 kd0178" style="display:none;">
    <img alt="" src="http://cdn.23met.ru/b/2019_severstal_992x60_new.jpg" style="display:block;left:0;top:0;z-index:1;width:100%;"/>
    <a href="https://market.severstal.com/ru/ru?utm_source=23met&amp;utm_medium=banner&amp;utm_campaign=brand_moscow&amp;utm_content=992x60_rw01.html" rel="nofollow noopener" style="display:none; position:absolute; left:0%;top:0;width:100%;height:60px;" target="_blank">
    </a>
   </div>
  </div>
  <nav>
   <div id="header-wrap">
    <ul id="header">
     <li class="logo">
      <a class="logo" href="/.html">
       <span style="color: #096;">
        23
       </span>
       <span style="color:#0063DC;">
        МЕТ
       </span>
      </a>
     </li>
     <!-- comment to delete space between inline elements
    -->
     <li>
      <a class="" href="/price.html">
       Металлопрокат
      </a>
     </li>
     <li>
      <a class="" href="/price_nerzh.html">
       Нержавейка
      </a>
     </li>
     <li class="submenu_link">
      <span class="">
       Цветные металлы
       <svg class="submenu_link-arrow" fill="#C0C0C0" height="4" viewbox="0 0 7 4" width="7">
        <path d="M 0 0 L 7 0 L 3.5 4 Z">
        </path>
       </svg>
      </span>
      <ul class="submenu_ul">
       <li>
        <a href="/price_aluminium.html">
         Алюминий/дюраль
        </a>
       </li>
       <li>
        <a href="/price_bronza.html">
         Бронза
        </a>
       </li>
       <li>
        <a href="/price_volfram.html">
         Вольфрам
        </a>
       </li>
       <li>
        <a href="/price_latun.html">
         Латунь
        </a>
       </li>
       <li>
        <a href="/price_magniy.html">
         Магний
        </a>
       </li>
       <li>
        <a href="/price_med.html">
         Медь
        </a>
       </li>
       <li>
        <a href="/price_nikel.html">
         Никель
        </a>
       </li>
       <li>
        <a href="/price_nihrom.html">
         Нихром
        </a>
       </li>
       <li>
        <a href="/price_olovo.html">
         Олово
        </a>
       </li>
       <li>
        <a href="/price_svinec.html">
         Свинец
        </a>
       </li>
       <li>
        <a href="/price_titan.html">
         Титан
        </a>
       </li>
       <li>
        <a href="/price_cink.html">
         Цинк
        </a>
       </li>
       <li>
        <a href="/price_cirkoniy.html">
         Цирконий
        </a>
       </li>
      </ul>
     </li>
     <li class="right">
      <a class="active" href="/calculator.html">
       Калькулятор
      </a>
      <a class="" href="/gosts.html">
       ГОСТы и ТУ
      </a>
      <a class="" href="/weight.html">
       Вес
      </a>
      <a class="" href="/spravka.html">
       Размеры
      </a>
      <span id="form-user-logreg-opener">
       Войти
      </span>
      <div id="form-userclient-logreg">
       <div class="popup-closer-container">
        <div class="popup-closer" onclick="form_user_logreg_show(0)">
         ×
        </div>
       </div>
       <div id="form-userclient-logreg-tabs">
        <span data-tab="user" onclick="form_user_logreg_show('user')">
         Посетитель
        </span>
        <span data-tab="client" onclick="form_user_logreg_show('client')">
         Клиент
        </span>
       </div>
       <form id="form-user-logreg">
        <input class="input" id="form-user-logreg-login"/>
        <input autocomplete="off" class="input" id="form-user-logreg-password"/>
        <button class="button" onclick="form_user_logreg_login()" type="button">
         Войти
        </button>
        <span class="form-user-logreg-register-new" onclick="form_user_logreg_register()">
         Зарегистрироваться
        </span>
        <br/>
        <br/>
        <a class="forget-password" href="/pasrec?need_password_recovery=1.html">
         Забыли пароль?
        </a>
       </form>
       <form id="form-client-logreg">
        <input class="input" id="form-client-logreg-login"/>
        <input autocomplete="off" class="input" id="form-client-logreg-password"/>
        <button class="button" onclick="form_client_logreg_login()" type="button">
         Войти
        </button>
       </form>
       <div class="message">
       </div>
       <div class="message-error">
       </div>
      </div>
      <script type="text/javascript">
       var global_user_params={

  'id':'',

  'hash':'',

  'login':'',

  'ignore_firms_stamp':''

};



var form_userclient_logreg_ghost_text={

    "form-user-logreg-login":"Email",

    "form-user-logreg-password":"Пароль",

    "form-client-logreg-login":"Имя пользователя",

    "form-client-logreg-password":"Пароль"

};





if( global_user_params['login'].length > 14 ){

  $("#form-user-logreg-userinfo-login").text( global_user_params['login'].substr(0,20) + '...' );

}

else{

  $("#form-user-logreg-userinfo-login").text( global_user_params['login'] );

}





$(document).ready(function(){ 



    if(global_user_params['id']) $("#form-user-logreg-opener").hide();

    else $("#form-user-logreg-userinfo").hide();



    $("#form-userclient-logreg").detach().appendTo('body');



    $("#form-userclient-logreg input").each(function() {

      if( typeof form_userclient_logreg_ghost_text[this.id] === "undefined" ) return;

      $(this).val( form_userclient_logreg_ghost_text[this.id] ).addClass("gray-text");

    });



    $("#form-userclient-logreg input").focus(function(){  

      if( typeof form_userclient_logreg_ghost_text[this.id] === "undefined" || $(this).val() != form_userclient_logreg_ghost_text[this.id] ) return;

      $(this).removeClass("error").removeClass("gray-text").val('');

    });



    $("#form-user-logreg-password, #form-client-logreg-password").on('click', function(){

      try{ $(this).attr('type', 'password'); }/*ie8 bug*/

      catch(e){}

    });



    $("#form-userclient-logreg input").blur(function(){

      if( typeof form_userclient_logreg_ghost_text[this.id] === "undefined" || $(this).val() !== '' ) return;

      $(this).addClass("gray-text").val( form_userclient_logreg_ghost_text[this.id] );



      if( $(this).attr('id') == 'form-user-logreg-password' || $(this).attr('id') == 'form-client-logreg-password' ){

          try{ $(this).attr('type', ''); }/*ie8 bug*/

          catch(e){}            

      }

    });





    $("#form-user-logreg-opener").click(function(){

      form_user_logreg_show('user');

    });

    $("#form-client-logreg-opener").click(function(){

      form_user_logreg_show('client');

    });

});







function form_client_logreg_login(){



  var reg_errors_fields = '';

  $("#form-client-logreg input").each(function(){

    if( typeof form_userclient_logreg_ghost_text[this.id] !== 'undefined' && $(this).val() == form_userclient_logreg_ghost_text[this.id] ) reg_errors_fields += (reg_errors_fields)? ' и '+form_userclient_logreg_ghost_text[this.id] : form_userclient_logreg_ghost_text[this.id];

  });



  if(reg_errors_fields){

    form_user_logreg_show_error('Укажите ' + reg_errors_fields);

    return;

  } 



  var login=$('#form-client-logreg-login').val();

  var password=$('#form-client-logreg-password').val();



  $.post("/cabinet", { ajax: 'login', login: login, password: password },

                    function(data){



                        data=jQuery.parseJSON(data);



                        if(data['error']){

                          form_user_logreg_show_error(data['error']);

                        }

                        if(data['ok']){

                           window.location = "/cabinet";

                        }                 

                    });

}



function form_user_logreg_login(){



  var reg_errors_fields = '';

  $("#form-user-logreg input").each(function(){

    if( typeof form_userclient_logreg_ghost_text[this.id] !== 'undefined' && $(this).val() == form_userclient_logreg_ghost_text[this.id] )  reg_errors_fields += (reg_errors_fields)? ' и '+form_userclient_logreg_ghost_text[this.id] : form_userclient_logreg_ghost_text[this.id];

  });



  if(reg_errors_fields){

    form_user_logreg_show_error('Укажите ' + reg_errors_fields);

    return;

  } 



  var login=$('#form-user-logreg-login').val();

  var password=$('#form-user-logreg-password').val();



  $.post("/user", { ajax: 'login', login: login, password: password },

                    function(data){



                        data=jQuery.parseJSON(data);



                        if(data['error']){

                          form_user_logreg_show_error(data['error']);

                        }

                        if(data['ok']){

                            location.reload();

                        }                 

                    });

}



function form_user_logreg_register(){



  var login=$('#form-user-logreg-login').val();

  var password=$('#form-user-logreg-password').val();



  var reg_errors_fields = '';

  $("#form-user-logreg input").each(function(){

    if( typeof form_userclient_logreg_ghost_text[this.id] !== 'undefined' && $(this).val() == form_userclient_logreg_ghost_text[this.id] ){

      reg_errors_fields += (reg_errors_fields)? ' и '+form_userclient_logreg_ghost_text[this.id] : form_userclient_logreg_ghost_text[this.id];

    }

  });



  if(reg_errors_fields){

    form_user_logreg_show_error('Укажите ' + reg_errors_fields);

    return;

  } 





  $.post("/user", { ajax: 'register', login: login, password: password },

                    function(data){

                      data=jQuery.parseJSON(data);

                      if(data['error']){

                        form_user_logreg_show_error(data['error']);

                      } 

                      if(data['ok']){ 

                          location.reload();

                      }                 

  });

}



function form_user_logreg_logout(){

  $.post("/user", { ajax: 'logout' },

                    function(data){

                       //alert(data);

                      data=jQuery.parseJSON(data);

                      if(data['error']){

                        

                      } 

                      if(data['ok']){

                        location.reload();

                      }                 

  });

}



function form_user_logreg_show_error(error_message){

  $('#form-userclient-logreg .message-error').stop().text(error_message).fadeTo(400, 1).delay(2000).fadeTo(400, 0);

}



function form_user_logreg_show(show, message){



  $('#form-userclient-logreg .message-error').stop();



  var el = $('#form-userclient-logreg');



  $(el).find('.message').hide();

  $(el).find('.message-error').hide();

  

  if(show){



    $('#form-userclient-logreg-tabs span').removeClass('form-userclient-logreg-tab-active');

    if(show=='user'){

      $('span[data-tab="user"]').addClass('form-userclient-logreg-tab-active');

      $('#form-user-logreg').show();

      $('#form-client-logreg').hide();

    }

    else{

      $('span[data-tab="client"]').addClass('form-userclient-logreg-tab-active');

      $('#form-client-logreg').show();

      $('#form-user-logreg').hide();

    }



    $(el).css({'top': 100 + $(document).scrollTop(), 'left': $(document).width()/2 - $(el).innerWidth()/2});



    if( !$(el).is(':visible') ){



      var ful_w = $(el).width();



      if(message) $(el).find('.message').text(message).stop(true,true).fadeTo(400, 1).delay(5500).fadeTo(400, 0, function(){ $(this).hide(); });

      else $(el).find('.message').text('').hide();

      

      $(el).show().width(ful_w);



      $('body').append('<div id="form-userclient-logreg-shadow" onclick="form_user_logreg_show(0)"></div>');

      $('#form-userclient-logreg-shadow').css({'top': 0, 'left': 0, 'width': $(document).width(), 'height': $(document).height()});

    }



    return;

  }



  $(el).hide();

  $('#form-userclient-logreg-shadow').remove();

}
      </script>
     </li>
    </ul>
   </div>
  </nav>
  <script type="text/javascript">
   $('body').on('click touchend', function(e){ 
    if( $(e.target).hasClass('submenu_link') || $(e.target).closest('.submenu_link, .submenu_ul').length ) submenu_ul_show(1, e.type, e.target);
    else submenu_ul_show(0, e.type);
});

$(window).resize(function(){ 
    if($('.submenu_ul').attr('data-window-width') == $(window).width()) return;
    submenu_ul_show(0); 
});

$('#header').scroll(function() {
    submenu_ul_show(0); 
});

function submenu_ul_show(show, e_type, e_target){

    if( e_type ){
        if( $(".submenu_link").attr('data-blocked') === 'yes' ) return;
        $(".submenu_link").attr('data-blocked', 'yes');
        setTimeout(function(){ $(".submenu_link").attr('data-blocked', ''); }, 300);
    }

    if( show ){
        if( !$(".submenu_link").find(".submenu_ul").length && $(e_target).closest('.submenu_link').length ){
            submenu_ul_show(0);
            return;
        }

        $(".submenu_ul").detach().appendTo('body').css('top', $(".submenu_link").offset().top + $(".submenu_link").outerHeight() + 1 ).attr('data-window-width', $(window).width()).show(); ;

        var l = $(".submenu_link").offset().left + $(".submenu_link").width()/2 - $(".submenu_ul").outerWidth()/ 2;
        var out_of_right_edge =  l + $(".submenu_ul").outerWidth() - $(window).width();
        if( out_of_right_edge > 0 ) l -= out_of_right_edge + 5;
        if( l < 5 ) l = 5;

        $(".submenu_ul").css('left', l);

        $('body').on('touchmove', function(e){ 
            $(".submenu_ul").attr('data-touch-scrolled', 1);
        });

        $('.submenu_link-arrow').addClass('submenu_link-arrow180');
    }
    else{
        if( e_type !== 'touchend' || (e_type === 'touchend' && $(".submenu_ul").attr('data-touch-scrolled') == 0) ){
            if( !$(".submenu_link").find(".submenu_ul").length ){
                $(".submenu_ul").hide();
                $(".submenu_ul").detach().appendTo('.submenu_link');
                $('.submenu_link-arrow').removeClass('submenu_link-arrow180');
            }
        }
    }
    $(".submenu_ul").attr('data-touch-scrolled', 0);
}
  </script>
  <script type="text/javascript">
   var calculator_def_ns = {n: "shyrypy", s: ""};
var calculator_last_setted_hash = null;

$(document).ready(function(){ 

    calculator_fill_naimenovanies_select( {"Арматура А1":[{"eng":"armatura_a1","rus":"Арматура А1"}],"Арматура А3":[{"eng":"armatura_a3","rus":"Арматура А3"}],"Арматура Ат800":[{"eng":"armatura_at800","rus":"Арматура Ат800"}],"Балка":[{"eng":"balka","rus":"Балка"}],"Катанка":[{"eng":"katanka","rus":"Катанка"}],"Квадрат":[{"eng":"kvadrat","rus":"Квадрат"}],"Крепеж":[{"eng":"bolty","rus":"Болты","first_in_group":1},{"eng":"vinty","rus":"Винты","first_in_group":0},{"eng":"gaiki","rus":"Гайки","first_in_group":0},{"eng":"gvozdi","rus":"Гвозди","first_in_group":0},{"eng":"samorezy","rus":"Саморезы","first_in_group":0},{"eng":"shaiby","rus":"Шайбы","first_in_group":0},{"eng":"shyrypy","rus":"Шурупы","first_in_group":0}],"Круг":[{"eng":"kryg","rus":"Круг"}],"Круг оцинк.":[{"eng":"kryg_ocink","rus":"Круг оцинк."}],"Лента\/штрипс":[{"eng":"lenta","rus":"Лента\/штрипс"}],"Лента\/штрипс оц.":[{"eng":"lenta_ocink","rus":"Лента\/штрипс оц."}],"Лист\/рулон г\/к":[{"eng":"list_gk","rus":"Лист\/рулон г\/к"}],"Лист\/рулон окраш.":[{"eng":"list_okrash","rus":"Лист\/рулон окраш."}],"Лист\/рулон оцинк.":[{"eng":"list_ocink","rus":"Лист\/рулон оцинк."}],"Лист\/рулон х\/к":[{"eng":"list_xk","rus":"Лист\/рулон х\/к"}],"Лист ПВ":[{"eng":"list_pv","rus":"Лист ПВ"}],"Лист рифленый":[{"eng":"list_rifl","rus":"Лист рифленый"}],"Плита":[{"eng":"plita","rus":"Плита"}],"Полоса":[{"eng":"polosa","rus":"Полоса"}],"Полоса оцинк.":[{"eng":"polosa_ocink","rus":"Полоса оцинк."}],"Проволока":[{"eng":"provoloka","rus":"Проволока"}],"Проволока оцинк.":[{"eng":"provoloka_ocink","rus":"Проволока оцинк."}],"Профнастил окраш.":[{"eng":"profnastil","rus":"Профнастил окраш."}],"Профнастил оц.":[{"eng":"profnastil_ocink","rus":"Профнастил оц."}],"Рельс":[{"eng":"rels","rus":"Рельс"}],"Труба ВГП":[{"eng":"tryba_vgp","rus":"Труба ВГП"}],"Труба ВГП оцинк.":[{"eng":"tryba_vgp_ocink","rus":"Труба ВГП оцинк."}],"Труба б\/ш г\/д":[{"eng":"tryba_gd","rus":"Труба б\/ш г\/д"}],"Труба б\/ш г\/д оц.":[{"eng":"tryba_gd_ocink","rus":"Труба б\/ш г\/д оц."}],"Труба б\/ш котельная":[{"eng":"tryba_bs_kotelnaya","rus":"Труба б\/ш котельная"}],"Труба б\/ш х\/д":[{"eng":"tryba_xd","rus":"Труба б\/ш х\/д"}],"Труба квадр.":[{"eng":"tryba_es_kvadr","rus":"Труба квадр."}],"Труба квадр. оц.":[{"eng":"tryba_es_kvadr_ocink","rus":"Труба квадр. оц."}],"Труба овал.":[{"eng":"tryba_es_oval","rus":"Труба овал."}],"Труба овал. оц.":[{"eng":"tryba_es_oval_ocink","rus":"Труба овал. оц."}],"Труба плоскоовал. (ароч.\/полуов.)":[{"eng":"tryba_es_ploskooval","rus":"Труба плоскоовал. (ароч.\/полуов.)"}],"Труба плоскоовал. (ароч.\/полуов.) оц.":[{"eng":"tryba_es_ploskooval_ocink","rus":"Труба плоскоовал. (ароч.\/полуов.) оц."}],"Труба прямоуг.":[{"eng":"tryba_es_pr","rus":"Труба прямоуг."}],"Труба прямоуг. оц.":[{"eng":"tryba_es_pr_ocink","rus":"Труба прямоуг. оц."}],"Труба э\/с":[{"eng":"tryba_es","rus":"Труба э\/с"}],"Труба э\/с оцинк.":[{"eng":"tryba_es_ocink","rus":"Труба э\/с оцинк."}],"Уголок":[{"eng":"ygolok","rus":"Уголок"}],"Уголок оцинк.":[{"eng":"ygolok_ocink","rus":"Уголок оцинк."}],"Шары мелющие":[{"eng":"shary_melushie","rus":"Шары мелющие"}],"Швеллер":[{"eng":"shveller","rus":"Швеллер"}],"Швеллер гнутый":[{"eng":"shveller_gnyt","rus":"Швеллер гнутый"}],"Швеллер гнутый оц.":[{"eng":"shveller_gnyt_ocink","rus":"Швеллер гнутый оц."}],"Швеллер оцинк.":[{"eng":"shveller_ocink","rus":"Швеллер оцинк."}],"Шестигранник":[{"eng":"shestigrannik","rus":"Шестигранник"}],"Шпунт Ларсена":[{"eng":"shpynt","rus":"Шпунт Ларсена"}]} );
    
    var hash = calculator_get_url_hash(1);

    if( $('#select-naimenovanie option[value="' + hash[0] + '"]').length ){
        load_sizes_and_calc_html( hash[0], hash[1], false );
        change_page_h1_to_default();
    }
    else{
        calculator_data_to_html(calculator_def_ns.n, {"sizes":["1.6х7","1.6х10","1.6х13","2.5х6","2.5х7","2.5х8","2.5х10","2.5х13","2.5х16","2.5х18","2.5х20","2.5х22","2.5х25","2х7","2х10","2х13","2х16","3.5х10","3.5х12","3.5х13","3.5х16","3.5х18","3.5х20","3.5х22","3.5х25","3.5х30","3.5х35","3.5х40","3.5х45","3.5х50","3.8х42","3.8х62","3.8х82","3х6","3х8","3х10","3х12","3х13","3х14","3х16","3х18","3х20","3х22","3х25","3х30","3х35","3х40","3х50","4.2х32","4.5х16","4.5х20","4.5х25","4.5х30","4.5х35","4.5х40","4.5х45","4.5х50","4.5х60","4.5х70","4.5х80","4х8","4х10","4х11","4х12","4х13","4х16","4х18","4х20","4х22","4х25","4х30","4х35","4х40","4х45","4х50","4х60","4х70","4х80","5х12","5х13","5х14","5х16","5х18","5х20","5х22","5х25","5х30","5х35","5х40","5х45","5х50","5х60","5х70","5х80","5х90","5х100","6х18","6х20","6х22","6х25","6х30","6х35","6х40","6х45","6х50","6х60","6х70","6х80","6х90","6х100","7х30","7х40","7х50","8х25","8х30","8х35","8х40","8х45","8х50","8х60","8х70","8х80","8х90","8х100","8х110","8х120","8х140","10х30","10х35","10х40","10х45","10х50","10х60","10х70","10х80","10х90","10х100","10х110","10х120","10х140","10х160","12х40","12х45","12х50","12х60","12х70","12х80","12х90","12х100","12х110","12х120","12х140","12х160","12х180","12х200","16х60","16х70","16х80","16х90","16х100","16х110","16х120","16х140","16х160","16х180","16х200","20х70","20х80","20х90","20х100","20х110","20х120","20х140","20х160","20х180","20х200"],"calc_html":"\r\n\r\n<!--calc_metiz-->\r\n<div class=\"calc_container\">\r\n    \r\n        <div class=\"calc_logo\"><\/div>\r\n    \r\n    <div class=\"calc_w_container\">\r\n        <input id=\"calc_w1\" class=\"calc_w_kg\" onkeyup=\"calculator_metiz(1,'1')\"  \/>\r\n        <label for=\"calc_w1\" class=\"calc_field_label\">кг<\/label>\r\n    <\/div> \r\n\r\n     <div class=\"calc_l_container\">\r\n        <input id=\"calc_c1\" class=\"calc_count\" onkeyup=\"calculator_metiz(0,'1')\"  \/>\r\n        <label for=\"calc_c1\" class=\"calc_field_label\">кол-во шт.<\/label>\r\n    <\/div>    \r\n\r\n\r\n    <div id=\"calc_popup_opener1\" class=\"calc_gost_wide calc_popup_opener\" onclick=\"calc_show_popup_list(1,'1')\">\r\n        <span class=\"calc_popup_opener_label\">ГОСТ 1144-80 <\/span>\r\n        <label class=\"calc_field_label\">стандарт<\/label>\r\n        <div id=\"calc_popup_list1\" class=\"calc_popup_list calc_popup_list_gost_wide\" data-kida=\"1\">\r\n                <div class=\"calc_popup_list_inner\">\r\n                                    <span onclick=\"calc_metiz_set_stal_koef(this,'0.130')\">ГОСТ 1144-80 <\/span>\r\n                                    <span onclick=\"calc_metiz_set_stal_koef(this,'0.090')\">ГОСТ 1145-80 <\/span>\r\n                                    <span onclick=\"calc_metiz_set_stal_koef(this,'0.100')\">ГОСТ 1146-80 <\/span>\r\n                                <\/div>\r\n        <\/div>\r\n    <\/div> \r\n\r\n\r\n    <input type=\"hidden\" id=\"calc_metiz_weight1\" value=\"0.130\" \/>\r\n    <input type=\"hidden\" id=\"calc_metiz_is_weight_of_10001\" value=\"1\" \/>\r\n    <input type=\"hidden\" id=\"calc_last_w_to_c1\" value=\"\" \/>\r\n\r\n    \r\n    <\/div>  \r\n\r\n\r\n<!--\/calc_metiz--> \r\n","cost_info":"","spravka_and_gosts_links":"<div id=\"calculator-spravka-and-gosts-link-container\"><a href=\"http:\/\/23met.ru\/gosts?n=shyrypy\">ГОСТы и ТУ на шурупы<\/a><\/div>","size":"1.6х7","size_exists_in_db":1,"size_pattern":null,"size_example":null,"size_pass_pattern":true});
    }

    $('#select-naimenovanie').change(function(){
        user_size_input_show_hide(false, true);
        $('#select-size').prop('disabled', true);

        load_sizes_and_calc_html( $(this).val(), '', true );
        $(this).blur();

        change_page_h1_to_default();
    });

    $('#select-size').change(function(){

        if( $(this).val() === 'users_size' ){
            user_size_input_show_hide(true, false);
            return;
        }

        load_sizes_and_calc_html( $('#select-naimenovanie').val(), $(this).val(), true );
        $(this).blur();
    });

    $(window).on('hashchange', function() {
        var hash = calculator_get_url_hash(1);

        if( hash[0] === $('#select-naimenovanie').val() && hash[1] === $('#select-size').val() ) return;
        if( calculator_last_setted_hash === calculator_get_url_hash(0) ) return;
 
        load_sizes_and_calc_html( hash[0], hash[1], false );
    });

});

function change_page_h1_to_default(){
    if( $('#page_title-calculator').attr('data-default') != $('#page_title-calculator').text() ){
        $('#page_title-calculator').text( $('#page_title-calculator').attr('data-default') );
    }
}

function load_sizes_and_calc_html(naimenovanie, size, change_hash ){

    calculator_size_example_popup_show_hide();

    if( !change_hash ){
        if( !naimenovanie ) naimenovanie = calculator_def_ns.n;
        if( !size ) size = calculator_def_ns.s;
    }

    if( change_hash ){
        var new_hash = '';
        if(naimenovanie){
            new_hash += naimenovanie.toString();
            if(size) new_hash += ';' + size.toString();
        }
        window.location.hash = new_hash;

        calculator_last_setted_hash = new_hash;
    }

    if( !$("#select-naimenovanie option[value='" + naimenovanie + "']").length ) return;

    calculator_dop_info_show_hide(0);

    $.post("/calculator", { 
                                                ajax: 'load_sizes_and_calc_html', 
                                                naimenovanie: naimenovanie,
                                                size: size,
                                                load_sizes: ($("#select-size").attr('data-naimenovanie') === naimenovanie)? 0 : 1
                                              },
        function(data){                
            calculator_dop_info_show_hide(1);
            calculator_data_to_html(naimenovanie, data);
    });
}

function calculator_data_to_html(naimenovanie, data){

    if( typeof(data) === 'string' ){
        data = jQuery.parseJSON(data);
    }

    if( data['sizes'] ){
        calculator_fill_sizes_select( 
                                    data['sizes'], 
                                    data['size_pattern'], 
                                    ( !data['size_exists_in_db'] && data['size_pass_pattern'] )? data['size'] : null 
                                    );
    }

    if( !data['size_exists_in_db'] ){
        calculator_add_custom_size_to_sizes_select( data['size'] );
    }
   
    if( data['calc_html'] ){
        $('#calc_html_container').html( data['calc_html'] ); 
    }
    else{
        $('#calc_html_container').html('');
    }

    $('#td-cost-info').html( data['cost_info'] );

    $('#td-spravka-and-gosts-links').html( data['spravka_and_gosts_links'] );

    $("#select-naimenovanie").val(naimenovanie);

    $("#select-size").attr('data-naimenovanie', naimenovanie);
    $("#select-size").attr('data-pattern', data['size_pattern']);
    $("#select-size").attr('data-example', data['size_example']);
    $("#select-size").attr('data-last-size', data['size']);

    $("#select-size").val(data['size']);
    $('#select-size').show();

    $('#cost-naimenovanie').html(  $("#select-naimenovanie option:selected").text() + ' ' + data['size'] );    
}

function calculator_fill_naimenovanies_select( naimenovanies ){
    var options = '';
    $.each( naimenovanies, function( rus_or_group, naims_ar ) {

        if( naims_ar[0]['first_in_group'] ){
            options += '<optgroup label="'+rus_or_group+'">';
            $.each( naims_ar, function( k, v ) {
                options += '<option value="'+v['eng']+'">'+v['rus']+'</option>';
            });
            options += '</optgroup>';
            if('ontouchstart' in window){
                options += '<option disabled="disabled">────</option>'
            }
        }
        else{
            options += '<option value="'+naims_ar[0]['eng']+'">'+naims_ar[0]['rus']+'</option>';
        }
        
    });
    $('#select-naimenovanie').append(options);
}

function calculator_fill_sizes_select( sizes, size_pattern, custom_size ){
    var options = '';

    if( size_pattern ) options += '<option value="users_size">Произвольный</option>';
    if( custom_size ) options += '<option value="'+custom_size+'">'+custom_size+'</option>';
    if( options ) options += '<option class="users_size_separator" disabled>────</option>';

    $.each( sizes, function( i, s ) {
        options += '<option value="'+s+'">'+s+'</option>';
    });

    $('#select-size').html(options);  
    $('#select-size').prop('disabled', false);
}

function calculator_add_custom_size_to_sizes_select( size ){
    if( $("#select-size option[value='" + size + "']").length ) return;
    $('<option value="' + size + '">' + size + '</option>').insertBefore('#select-size .users_size_separator');  
}

function user_size_input_show_hide( show, naim_changed, user_entered_size ){

    calculator_size_example_popup_show_hide();

    if( show ){
        
        var select_el = $('#select-size');
        var sew = select_el.outerWidth();
        var seh = select_el.height();

        if( !$('#select-size-users').length ){
            select_el.parent().append('<input id="select-size-users" value = "" />');

            $('#select-size-users').on('keyup',function(e) {
                calculator_size_example_popup_show_hide();

                if(e.which !== 13) return;

                var s = $(this).val();
                s = s.replace(/[\s]+/g, '').replace(/[xXХ]/g, 'х').replace(/,/g, '.');

                if( !calculator_is_size_match_pattern(s) ){
                    calculator_size_example_popup_show_hide( $('#select-size').attr('data-example') );
                    return;
                }

                user_size_input_show_hide( false, false, true );
                calculator_add_custom_size_to_sizes_select(s);
            
                $('#select-size').val(s).change();
            });

        }

        if( !$('#select-size-users-close').length ){
            select_el.parent().append('<label id="select-size-users-close" style="position:absolute; top:1px; text-align:center; cursor:pointer; color:red;" >X</label>' );

            $('#select-size-users-close').on('click',function() {
                user_size_input_show_hide(false, false);
            });
        }
        
        $('#select-size-users').css('width', sew );
        $('#select-size-users-close').css('width', seh ).css('height', seh ).css('line-height', seh + 'px' ).css('left', sew - seh);

        select_el.hide();

        calculator_dop_info_show_hide(0);      
        
        $('#select-size-users').focus();

    }
    else{
        $('#select-size-users').remove();
        $('#select-size-users-close').remove();  

        if( !naim_changed && !user_entered_size ){
            var s = $('#select-size').attr('data-last-size');
            if( !s ) s = calculator_def_ns.s;
            
            if( is_naimenovanie_and_size_in_hash( $('#select-naimenovanie').val(), s ) ){
                calculator_dop_info_show_hide(1);

                $('#select-size').val(s);
                $('#select-size').show();
            }
            else{
                load_sizes_and_calc_html( $('#select-naimenovanie').val(), s, true ); 
            }
        }

  
    }

}

function calculator_size_example_popup_show_hide( s ){
    if( !s ){
        $('#calc_pattern_example_help_popup').remove();
        return;
    }

    $('body').append('<div id="calc_pattern_example_help_popup" class="help_popup" style="position:absolute; text-align:center; top:'+ ($('#select-size-users').offset().top + $('#select-size-users').height() + 4)+'px; ">Допустимый формат размера: '+ s +'</div>');    

    $('#calc_pattern_example_help_popup').css('left', $('#select-size-users').offset().left - $('#calc_pattern_example_help_popup').width()/2 );
}

function calculator_get_url_hash( return_array ){
    var hash = decodeURI(window.location.hash.substring(1));
    if( return_array ) hash = hash.split(';');
    return hash;
}

function calculator_is_size_match_pattern( s ){
    var pattern = $('#select-size').attr('data-pattern');
    if( !pattern ) return 1;

    var regex = new RegExp( '^' + pattern + '$', 'i' );
    if( regex.test(s) ) return 1;
    return 0;
}

function is_naimenovanie_and_size_in_hash( naimenovanie, size ){
    var hash = calculator_get_url_hash(1);
    return ( hash[0] === naimenovanie && hash[1] === size )? true : false;
}

function calculator_dop_info_show_hide( show ){

    if(show){
        $('.calculator-glass').remove();
    }
    else{
        $('#calc_html_container').append('<div class="calculator-glass" style="width:100%; height:'+($('#calc_html_container').outerHeight()+2)+'px;"></div>');
        $('#calculator-cost-info-container').append('<div class="calculator-glass" style="width:100%; height:'+($('#calculator-cost-info-container').outerHeight()+2)+'px;"></div>');
    }
}
  </script>
  <div id="content">
   <div>
    <h1 data-default="Калькулятор металлопроката" id="page_title-calculator">
     Калькулятор веса шурупов
    </h1>
   </div>
   <table id="table-calc-container">
    <tr>
     <td id="td-select-naimenovanie">
      <select id="select-naimenovanie">
      </select>
     </td>
     <td id="td-select-size">
      <div style="position:relative;">
       <select id="select-size">
       </select>
      </div>
     </td>
    </tr>
    <tr>
     <td colspan="2" id="td-calculator">
      <div id="calc_html_container-wrap">
       <div class="calculator-overflow-x-scroller" id="calc_html_container">
       </div>
      </div>
     </td>
    </tr>
    <tr>
     <td colspan="2" id="td-cost-info">
     </td>
    </tr>
    <tr>
     <td colspan="2" id="td-spravka-and-gosts-links">
     </td>
    </tr>
   </table>
  </div>
  <nav>
   <div id="footer">
    <ul class="footer-links" style="margin-left:0px;">
     <li>
      <a href="/content/tariffs.html">
       Реклама на сайте
      </a>
     </li>
     <li>
      <a href="/content/contacts.html">
       Контакты
      </a>
     </li>
    </ul>
    <ul class="footer-links">
     <li id="login-form-link">
      <span id="form-client-logreg-opener">
       Личный кабинет (для клиентов)
      </span>
     </li>
    </ul>
    <ul class="footer-links">
     <li>
      <a href="/calculator.html">
       Калькулятор металлопроката
      </a>
     </li>
     <li>
      <a href="/gosts.html">
       ГОСТы и ТУ
      </a>
     </li>
     <li>
      <a href="/weight.html">
       Вес
      </a>
     </li>
     <li>
      <a href="/spravka.html">
       Размеры
      </a>
     </li>
    </ul>
    <div style="clear:both">
    </div>
   </div>
  </nav>
  </body>
</html>